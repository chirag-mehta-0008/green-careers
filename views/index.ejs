<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoCareers - Pro Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Outfit', sans-serif; }
        .glass-sidebar { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-right: 1px solid rgba(0, 0, 0, 0.05); }
        .active-nav { background: #ecfdf5; color: #059669; border-right: 4px solid #059669; }
        
        /* Mobile Active State (Green Pill) */
        .mobile-active { background-color: #10b981; color: white; border-color: #10b981; box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.3); }
        
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 flex h-screen overflow-hidden">

    <% 
    const categories = [
        { name: 'ESG', icon: 'fa-globe-americas', label: 'ESG & Green' },
        { name: 'Developer', icon: 'fa-code', label: 'Dev & Tech' },
        { name: 'Business', icon: 'fa-briefcase', label: 'Business' },
        { name: 'Marketing', icon: 'fa-bullhorn', label: 'Marketing' },
        { name: 'Data', icon: 'fa-chart-pie', label: 'Data & AI' },
        { name: 'Remote', icon: 'fa-laptop-house', label: 'Remote' }
    ];
    %>

    <aside class="w-64 glass-sidebar h-full flex-col hidden md:flex z-20 shadow-xl">
        <div class="h-20 flex items-center px-8 border-b border-gray-100 bg-white/50">
            <i class="fas fa-leaf text-emerald-500 text-2xl mr-2"></i>
            <span class="text-xl font-bold tracking-tight text-gray-800">Eco<span class="text-emerald-500">Careers</span></span>
        </div>
        <div class="flex-1 overflow-y-auto py-6">
            <p class="px-6 text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Quick Filters</p>
            <nav class="space-y-1">
                <% categories.forEach(cat => { %>
                    <a href="/app?source=<%= source %>&category=<%= cat.name %>" 
                       class="flex items-center px-6 py-3.5 text-sm font-medium transition-colors duration-200 <%= category === cat.name ? 'active-nav' : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900' %>">
                        <i class="fas <%= cat.icon %> w-6 text-lg <%= category === cat.name ? 'text-emerald-600' : 'text-gray-400' %>"></i> <%= cat.label %>
                    </a>
                <% }) %>
            </nav>
        </div>
        <div class="p-6 border-t border-gray-100 bg-gray-50/50">
            <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-3">Data Source</p>
            <div class="flex bg-white rounded-lg p-1 border border-gray-200 shadow-sm">
                <a href="/app?source=linkedin&category=<%= category %>" class="flex-1 py-2 text-center rounded-md text-xs font-bold transition <%= source === 'linkedin' ? 'bg-[#0077b5] text-white shadow-sm' : 'text-gray-500 hover:bg-gray-50' %>"><i class="fab fa-linkedin"></i> LinkedIn</a>
                <a href="/app?source=twitter&category=<%= category %>" class="flex-1 py-2 text-center rounded-md text-xs font-bold transition <%= source === 'twitter' ? 'bg-black text-white shadow-sm' : 'text-gray-500 hover:bg-gray-50' %>"><i class="fab fa-twitter"></i> X / Twitter</a>
            </div>
        </div>
    </aside>

    <main class="flex-1 h-full overflow-y-auto bg-[#f8fafc] relative w-full">
        
        <div class="md:hidden h-16 bg-white/90 backdrop-blur-md border-b flex items-center justify-between px-4 sticky top-0 z-50 shadow-sm">
            <span class="font-bold text-lg flex items-center gap-2"><i class="fas fa-leaf text-emerald-500"></i> EcoCareers</span>
            <div class="flex bg-gray-100 rounded-lg p-1">
                <a href="/app?source=linkedin&category=<%= category %>" class="px-3 py-1 rounded text-xs font-bold <%= source === 'linkedin' ? 'bg-[#0077b5] text-white shadow' : 'text-gray-500' %>"><i class="fab fa-linkedin"></i></a>
                <a href="/app?source=twitter&category=<%= category %>" class="px-3 py-1 rounded text-xs font-bold <%= source === 'twitter' ? 'bg-black text-white shadow' : 'text-gray-500' %>"><i class="fab fa-twitter"></i></a>
            </div>
        </div>

        <div class="md:hidden bg-white border-b border-gray-100 overflow-x-auto whitespace-nowrap sticky top-16 z-40 py-3 px-4 no-scrollbar shadow-sm">
            <% categories.forEach(cat => { %>
                <a href="/app?source=<%= source %>&category=<%= cat.name %>" 
                   class="inline-flex items-center px-4 py-2 rounded-full text-xs font-bold mr-2 border transition-all duration-300
                   <%= category === cat.name ? 'mobile-active' : 'bg-slate-50 text-slate-600 border-slate-200' %>">
                    <i class="fas <%= cat.icon %> mr-2"></i> <%= cat.label %>
                </a>
            <% }) %>
        </div>

        <div class="p-4 md:p-8 max-w-7xl mx-auto">
            <div class="flex flex-col xl:flex-row justify-between items-start xl:items-center mb-8 gap-5">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-900 leading-tight"><%= category %> Jobs</h1>
                    <p class="text-xs md:text-sm text-gray-500 flex items-center gap-2 mt-1"><span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span> Scanning live feed (Last 60 Days)</p>
                </div>
                <div class="flex flex-col md:flex-row gap-3 w-full xl:w-auto items-stretch md:items-center">
                    <form action="/app" method="GET" class="flex gap-2 w-full md:w-auto">
                        <input type="hidden" name="source" value="<%= source %>">
                        <div class="relative w-full md:w-72">
                            <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="text" name="category" placeholder="Search role..." class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 bg-white text-sm font-medium focus:outline-none focus:border-emerald-500 shadow-sm" value="<%= category %>">
                        </div>
                        <button type="submit" class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-3 rounded-xl font-bold shadow-sm">Search</button>
                    </form>
                    <a href="/app?source=<%= source %>&category=<%= category %>&refresh=true" class="bg-white border border-gray-200 text-gray-600 hover:text-emerald-600 px-6 py-3 rounded-xl text-sm font-bold shadow-sm flex items-center justify-center gap-2"><i class="fas fa-sync-alt"></i> Refresh</a>
                </div>
            </div>

            <% if(error || results.length === 0) { %>
                <div class="flex flex-col items-center justify-center py-20 text-center px-4">
                    <div class="bg-white p-6 rounded-full shadow-sm mb-4"><i class="fas fa-search text-4xl text-gray-300"></i></div>
                    <h3 class="text-lg font-bold text-gray-700">No Fresh Posts Found</h3>
                    <p class="text-sm text-gray-400 mt-2">Try refreshing to fetch new API data.</p>
                </div>
            <% } else { %>
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-2 gap-4 md:gap-6 pb-20">
                    <% results.forEach((job, index) => { %>
                        <div class="bg-white rounded-2xl p-5 md:p-6 border border-gray-100 shadow-sm card-hover transition-all duration-300 flex flex-col h-full relative group job-card-container">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-10 h-10 md:w-12 md:h-12 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-md flex-shrink-0 <%= source === 'linkedin' ? 'bg-[#0077b5]' : 'bg-black' %>"><i class="fab <%= source === 'linkedin' ? 'fa-linkedin-in' : 'fa-twitter' %>"></i></div>
                                <div class="flex-1 min-w-0">
                                    <h4 class="font-bold text-gray-900 text-sm md:text-base truncate"><%= source === 'linkedin' ? 'LinkedIn Recruiter' : 'Twitter Recruiter' %> <i class="fas fa-check-circle text-blue-500 text-xs ml-1"></i></h4>
                                    <p class="text-[10px] md:text-xs text-gray-400 font-bold uppercase tracking-wide"><%= category %> HIRING</p>
                                </div>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 mb-4 md:mb-6 flex-grow h-auto md:h-32 overflow-hidden relative">
                                <p class="text-slate-700 text-xs md:text-sm leading-relaxed font-medium line-clamp-4"><%= job.text %></p>
                                <div class="absolute bottom-0 left-0 w-full h-8 bg-gradient-to-t from-slate-50 to-transparent"></div>
                                <div class="hidden full-post-text"><%= job.text %></div>
                                <div class="hidden full-post-link"><%= job.link %></div>
                                <div class="hidden full-post-source"><%= source %></div>
                                <div class="hidden full-post-employer"><%= job.employer_name %></div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 mt-auto">
                                <button onclick="openModal(this)" class="w-full py-2.5 rounded-lg bg-white border border-gray-200 text-gray-600 text-xs font-bold hover:bg-gray-50 transition flex items-center justify-center gap-2"><i class="fas fa-expand-alt"></i> Read Full</button>
                                <a href="<%= job.link %>" target="_blank" class="w-full py-2.5 rounded-lg text-white text-xs font-bold transition flex items-center justify-center gap-2 shadow-md <%= source === 'linkedin' ? 'bg-[#0077b5]' : 'bg-black' %>">View Post <i class="fas fa-external-link-alt"></i></a>
                            </div>
                        </div>
                    <% }) %>
                </div>
            <% } %>
        </div>
    </main>

    <div id="readModal" class="fixed inset-0 z-[100] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm transition-opacity opacity-0" id="modalBackdrop"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-xl bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-lg opacity-0 scale-95" id="modalPanel">
                    <div id="modalContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const modal = document.getElementById('readModal');
        const backdrop = document.getElementById('modalBackdrop');
        const panel = document.getElementById('modalPanel');
        const modalContent = document.getElementById('modalContent');

        function openModal(btn) {
            const card = btn.closest('.job-card-container');
            const text = card.querySelector('.full-post-text').textContent.trim();
            const link = card.querySelector('.full-post-link').textContent.trim();
            const source = card.querySelector('.full-post-source').textContent.trim();
            const employer = card.querySelector('.full-post-employer').textContent.trim();
            let html = '';

            if(source.includes('linkedin')) {
                html = `
                    <div class="bg-white font-['Roboto'] text-sm text-gray-900">
                        <div class="flex items-start gap-3 p-4 border-b border-gray-100 pb-3">
                            <div class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center border border-gray-300"><i class="fas fa-user text-gray-400 text-xl"></i></div>
                            <div class="flex-1"><h3 class="font-bold text-[14px] leading-tight hover:underline hover:text-[#0077b5] cursor-pointer">${employer} <span class="text-gray-500 font-normal">• 2nd</span></h3><p class="text-[12px] text-gray-500 leading-tight mt-0.5 w-60 truncate">Recruiter • Hiring Manager</p><p class="text-[12px] text-gray-500 mt-0.5 flex items-center gap-1"><span class="text-xs">2d • </span> <i class="fas fa-globe-americas text-[10px]"></i></p></div>
                            <button onclick="closeModal()" class="text-gray-500 hover:bg-gray-100 p-2 rounded-full"><i class="fas fa-times text-lg"></i></button>
                        </div>
                        <div class="p-4 pt-3 text-[14px] leading-relaxed whitespace-pre-wrap text-black">${text}<br><br><span class="text-gray-400 text-xs italic">... (Click 'View Post' for more)</span></div>
                        <div class="px-4 py-2 border-t border-gray-100 flex justify-between text-gray-500 text-xs font-bold"><button class="flex items-center gap-2 hover:bg-gray-100 px-4 py-3 rounded flex-1 justify-center"><i class="far fa-thumbs-up text-lg"></i> Like</button><button class="flex items-center gap-2 hover:bg-gray-100 px-4 py-3 rounded flex-1 justify-center"><i class="far fa-comment-dots text-lg"></i> Comment</button><button class="flex items-center gap-2 hover:bg-gray-100 px-4 py-3 rounded flex-1 justify-center"><i class="fas fa-share text-lg"></i> Share</button></div>
                        <div class="p-4 bg-gray-50"><a href="${link}" target="_blank" class="block w-full text-center bg-[#0077b5] text-white font-bold py-2 rounded-full hover:bg-[#006097] transition">View Full Post on LinkedIn</a></div>
                    </div>`;
            } else {
                html = `
                    <div class="bg-white font-sans text-base text-gray-900">
                        <div class="flex justify-between items-start p-4 pb-0"><div class="flex gap-3"><div class="w-10 h-10 rounded-full bg-black flex items-center justify-center text-white"><i class="fab fa-twitter"></i></div><div><h3 class="font-bold text-[15px] leading-tight flex items-center gap-1">${employer} <i class="fas fa-certificate text-blue-400 text-xs"></i></h3><p class="text-[14px] text-gray-500">@${employer.replace(/\s/g,'').toLowerCase()}</p></div></div><button onclick="closeModal()" class="text-gray-900 hover:bg-gray-100 p-2 rounded-full"><i class="fas fa-times text-lg"></i></button></div>
                        <div class="p-4 text-[17px] leading-snug whitespace-pre-wrap text-black">${text}</div>
                        <div class="px-4 pb-3 text-gray-500 text-[14px]">10:30 AM · Recent · <span class="font-bold text-black">Views</span></div>
                        <div class="border-t border-b border-gray-100 px-4 py-3 flex gap-6 text-sm"><span class="text-gray-500"><strong class="text-black">12</strong> Reposts</span><span class="text-gray-500"><strong class="text-black">45</strong> Likes</span></div>
                        <div class="px-4 py-3 flex justify-between text-gray-500 text-lg border-b border-gray-100"><i class="far fa-comment hover:text-blue-500"></i><i class="fas fa-retweet hover:text-green-500"></i><i class="far fa-heart hover:text-pink-500"></i><i class="far fa-bookmark hover:text-blue-500"></i></div>
                        <div class="p-4"><a href="${link}" target="_blank" class="block w-full text-center bg-black text-white font-bold py-3 rounded-full hover:bg-gray-800 transition">View Full Post on X</a></div>
                    </div>`;
            }
            modalContent.innerHTML = html;
            modal.classList.remove('hidden');
            setTimeout(() => { backdrop.classList.remove('opacity-0'); panel.classList.remove('opacity-0', 'scale-95'); panel.classList.add('opacity-100', 'scale-100'); }, 10);
        }
        function closeModal() {
            backdrop.classList.add('opacity-0'); panel.classList.remove('opacity-100', 'scale-100'); panel.classList.add('opacity-0', 'scale-95');
            setTimeout(() => { modal.classList.add('hidden'); }, 200);
        }
    </script>
</body>
</html>